
{% block stylesheets %}
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
          integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
          crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.4.1/dist/MarkerCluster.Default.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css"/>
    {{ encore_entry_link_tags('app') }}
{% endblock %}

{% block body %}
    <div id="maCarte"></div>
{% endblock %}

{% block javascripts %}
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
            integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
            crossorigin=""></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
    <script>
        var markersArray = [];
        var carte = L.map('maCarte').setView([47.8941, 1.89445], 25);
        L.tileLayer('https://{s}.tile.openstreetmap.fr/hot/{z}/{x}/{y}.png', {
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Tiles style by <a href="https://www.hotosm.org/" target="_blank">Humanitarian OpenStreetMap Team</a> hosted by <a href="https://openstreetmap.fr/" target="_blank">OpenStreetMap France</a>',
            minZoom: 1,
            maxZoom: 30,
        }).addTo(carte);

        {% if start is not empty  and finish is not empty %}
        L.Routing.control({
            waypoints: [
                L.latLng({{ start.0 }}, {{ start.1 }}),
                L.latLng({{ finish.0 }}, {{ finish.1 }})
            ],
            routeWhileDragging: true
        }).addTo(carte);
        {% endif %}

        var markers = L.markerClusterGroup();

        var icone = L.icon({
            iconUrl: "https://i.postimg.cc/2Sq8yn2f/bike.png",
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [-3, -76],
        });
        var icone_car = L.icon({
            iconUrl: "https://i.postimg.cc/7YZN95jf/parking.png",
            iconSize: [50, 50],
            iconAnchor: [25, 50],
            popupAnchor: [-3, -76],
        });

        var marker = L.marker([47.8941, 1.89445]);
        marker.bindPopup("<p> Lab'o, 1 avenue du champs de Mars </p>");
        markers.addLayer(marker);
        markersArray.push(marker);

        {% for infoStation in infoStations %}
        var marker = L.marker([{{ infoStation.pointgeo.0 }}, {{ infoStation.pointgeo.1 }}], {icon: icone});
        marker.bindPopup("<b> {{ infoStation.nomstation }} </br>nombre de places {{ infoStation.numplace }} </b>");
        markers.addLayer(marker);
        markersArray.push(marker);
        {% endfor %}

        {% for infoParking in infoParkings %}
        var marker = L.marker([{{ infoParking.coords.0 }}, {{ infoParking.coords.1 }}], {icon: icone_car});
        marker.bindPopup("<b> {{ infoParking.name }} </br>nombre de places disponibles {{ infoParking.dispo }} </b>");
        markers.addLayer(marker);
        markersArray.push(marker);
        {% endfor %}

        var groupe = new L.featureGroup(markersArray);
        carte.fitBounds(groupe.getBounds().pad(0.5));
        carte.addLayer(markers);
    </script>
    {{ encore_entry_script_tags('app') }}
{% endblock %}
